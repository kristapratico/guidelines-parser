[
  {
    "id": "python-network-http-pipeline",
    "category": "Http pipeline",
    "text": "DO use the [HTTP pipeline] to send requests to service REST endpoints."
  },
  {
    "id": "python-network-use-policies",
    "category": "Http pipeline",
    "text": "YOU SHOULD include the following policies in the HTTP pipeline: Unique Request ID (azure.core.pipeline.policies.RequestIdPolicy) Headers (azure.core.pipeline.policies.HeadersPolicy) Telemetry (azure.core.pipeline.policies.UserAgentPolicy) Proxy (azure.core.pipeline.policies.ProxyPolicy) Content decoding (azure.core.pipeline.policies.ContentDecodePolicy) Retry (azure.core.pipeline.policies.RetryPolicy and azure.core.pipeline.policies.AsyncRetryPolicy) Credentials (e.g. BearerTokenCredentialPolicy, AzureKeyCredentialPolicy, etc) Distributed tracing (azure.core.pipeline.policies.DistributedTracingPolicy) Logging (azure.core.pipeline.policies.NetworkTraceLoggingPolicy) ```python from azure.core.pipeline import Pipeline from azure.core.pipeline.policies import (   BearerTokenCredentialPolicy,   ContentDecodePolicy,   DistributedTracingPolicy,   HeadersPolicy,   HttpLoggingPolicy,   NetworkTraceLoggingPolicy,   UserAgentPolicy, ) class ExampleClient(object):   ...   def _create_pipeline(self, credential, base_url=None, **kwargs):     transport = kwargs.get('transport') or RequestsTransport(**kwargs)     try:       policies = kwargs['policies']     except KeyError:       scope = base_url.strip(\"/\") + \"/.default\"       if hasattr(credential, \"get_token\"):         credential_policy = BearerTokenCredentialPolicy(credential, scope)       else:         raise ValueError(           \"Please provide an instance from azure-identity or a class that implement the 'get_token protocol\"         )       policies = [         HeadersPolicy(**kwargs),         UserAgentPolicy(**kwargs),         ContentDecodePolicy(**kwargs),         RetryPolicy(**kwargs),         credential_policy,         HttpLoggingPolicy(**kwargs),         DistributedTracingPolicy(**kwargs),         NetworkTraceLoggingPolicy(**kwargs)       ]     return Pipeline(transport, policies)  ``` Some services may require custom policies to be implemented. For example, custom policies may implement fall back to secondary endpoints during retry, request signing, or other specialized authentication techniques."
  },
  {
    "id": "python-pipeline-core-policies",
    "category": "Custom policies",
    "text": "YOU SHOULD use the policy implementations in azure-core whenever possible."
  },
  {
    "id": "python-custom-policy-review",
    "category": "Custom policies",
    "text": "DO review the proposed policy with the Azure SDK [Architecture Board]. There may already be an existing policy that can be modified/parameterized to satisfy your need."
  },
  {
    "id": "python-custom-policy-base-class",
    "category": "Custom policies",
    "text": "DO derive from HTTPPolicy (https://azuresdkdocs.blob.core.windows.net/$web/python/azure-core/1.9.0/azure.core.pipeline.policies.html#azure.core.pipeline.policies.HTTPPolicy) AsyncHTTPPolicy (https://azuresdkdocs.blob.core.windows.net/$web/python/azure-core/1.9.0/azure.core.pipeline.policies.html#azure.core.pipeline.policies.AsyncHTTPPolicy) (if you need to make network calls) or SansIOHTTPPolicy (https://azuresdkdocs.blob.core.windows.net/$web/python/azure-core/1.9.0/azure.core.pipeline.policies.html#azure.core.pipeline.policies.SansIOHTTPPolicy) (if you do not)."
  },
  {
    "id": "python-custom-policy-thread-safe",
    "category": "Custom policies",
    "text": "DO ensure thread-safety for custom policies. A practical consequence of this is that you should keep any per-request or connection bookkeeping data in the context rather than in the policy instance itself."
  },
  {
    "id": "python-pipeline-document-policies",
    "category": "Custom policies",
    "text": "DO document any custom policies in your package. The documentation should make it clear how a user of your library is supposed to use the policy."
  },
  {
    "id": "python-pipeline-policy-namespace",
    "category": "Custom policies",
    "text": "DO add the policies to the azure.<package name>.pipeline.policies namespace."
  },
  {
    "id": "python-client-parameter-validation",
    "category": "Parameter validation",
    "text": "DO NOT use isinstance to validate parameter value types other than for built-in types (https://docs.python.org/3/library/stdtypes.html) (e.g. str etc). For other types, use [structural type checking]."
  },
  {
    "id": "python-models-repr",
    "category": "Supporting types",
    "text": "DO implement __repr__ for model types. The representation must include the type name and any key properties (that is, properties that help identify the model instance)."
  },
  {
    "id": "python-models-repr-length",
    "category": "Supporting types",
    "text": "DO truncate the output of __repr__ after 1024 characters. Any Enums defined in the SDK should be interchangeable with case-insensitive strings. This is achieved by using the CaseInsensitiveEnumMeta class defined in azure-core. ```python from enum import Enum from six import with_metaclass from azure.core import CaseInsensitiveEnumMeta class MyCustomEnum(with_metaclass(CaseInsensitiveEnumMeta, str, Enum)):   FOO = 'foo'   BAR = 'bar' ```"
  },
  {
    "id": "python-envvars-global",
    "category": "Configuration",
    "text": "DO honor the following environment variables for global configuration settings: | Environment Variable     | Purpose                                          | |-------------------------------|--------------------------------------------------------------------------------------------| | **Proxy Settings**      |                                              | | HTTP_PROXY          | Proxy for HTTP connections                                 | | HTTPS_PROXY          | Proxy for HTTPS connections                                | | NO_PROXY           | Hosts which must not use a proxy                              | | ALL_PROXY           | Proxy for HTTP and/or HTTPS connections in case HTTP_PROXY and/or HTTPS_PROXY are not defined | | **Identity**         |                                              | | MSI_ENDPOINT         | Azure AD MSI Credentials                                  | | MSI_SECRET          | Azure AD MSI Credentials                                  | | AZURE_USERNAME        | Azure username for U/P Auth                                | | AZURE_PASSWORD        | Azure password for U/P Auth                                | | AZURE_CLIENT_CERTIFICATE_PATH | Azure Active Directory                                   | | AZURE_CLIENT_ID        | Azure Active Directory                                   | | AZURE_CLIENT_SECRET      | Azure Active Directory                                   | | AZURE_TENANT_ID        | Azure Active Directory                                   | | AZURE_AUTHORITY_HOST     | Azure Active Directory                                   | | **Pipeline Configuration**  |                                              | | AZURE_TELEMETRY_DISABLED   | Disables telemetry                                     | | AZURE_LOG_LEVEL        | Enable logging by setting a log level.                           | | AZURE_TRACING_DISABLED    | Disables tracing                                      | | **General SDK Configuration** |                                              | | AZURE_CLOUD          | Name of the sovereign cloud                                | | AZURE_SUBSCRIPTION_ID     | Azure subscription                                     | | AZURE_RESOURCE_GROUP     | Azure Resource Group                                    | "
  },
  {
    "id": "python-logging-usage",
    "category": "Logging",
    "text": "DO use Pythons standard logging module (https://docs.python.org/3/library/logging.html) "
  },
  {
    "id": "python-logging-nameed-logger",
    "category": "Logging",
    "text": "DO provide a named logger for your library. The logger for your package must use the name of the module. The library may provide additional child loggers. If child loggers are provided, document them. For example: Package name: azure-someservice Module name: azure.someservice Logger name: azure.someservice Child logger: azure.someservice.achild These naming rules allow the consumer to enable logging for all Azure libraries, a specific client library, or a subset of a client library."
  },
  {
    "id": "python-logging-error",
    "category": "Logging",
    "text": "DO use the ERROR logging level for failures where it's unlikely the application will recover (for example, out of memory)."
  },
  {
    "id": "python-logging-warn",
    "category": "Logging",
    "text": "DO use the WARNING logging level when a function fails to perform its intended task. The function should also raise an exception. Don't include occurrences of self-healing events (for example, when a request will be automatically retried)."
  },
  {
    "id": "python-logging-info",
    "category": "Logging",
    "text": "DO use the INFO logging level when a function operates normally."
  },
  {
    "id": "python-logging-debug",
    "category": "Logging",
    "text": "DO use the DEBUG logging level for detailed trouble shooting scenarios. The DEBUG logging level is intended for developers or system administrators to diagnose specific failures."
  },
  {
    "id": "python-logging-sensitive-info",
    "category": "Logging",
    "text": "DO NOT send sensitive information in log levels other than DEBUG. For example, redact or remove account keys when logging headers."
  },
  {
    "id": "python-logging-request",
    "category": "Logging",
    "text": "DO log the request line, response line, and headers for an outgoing request as an INFO message."
  },
  {
    "id": "python-logging-cancellation",
    "category": "Logging",
    "text": "DO log an INFO message, if a service call is canceled."
  },
  {
    "id": "python-logging-exceptions",
    "category": "Logging",
    "text": "DO log exceptions thrown as a WARNING level message. If the log level set to DEBUG, append stack trace information to the message. You can determine the logging level for a given logger by calling logging.Logger.isEnabledFor (https://docs.python.org/3/library/logging.html#logging.Logger.isEnabledFor) "
  },
  {
    "id": "python-tracing-span-per-method",
    "category": "Distributed tracing",
    "text": "DO create a new trace span for each library method invocation. The easiest way to do so is by adding the distributed tracing decorator from azure.core.tracing."
  },
  {
    "id": "python-tracing-span-name",
    "category": "Distributed tracing",
    "text": "DO use <package name>/<method name> as the name of the span."
  },
  {
    "id": "python-tracing-span-per-call",
    "category": "Distributed tracing",
    "text": "DO create a new span for each outgoing network call. If using the HTTP pipeline, the new span is created for you."
  },
  {
    "id": "python-tracing-propagate",
    "category": "Distributed tracing",
    "text": "DO propagate tracing context on each outgoing service request. Client library usage telemetry is used by service teams (not consumers) to monitor what SDK language, client library version, and language/platform info a client is using to call into their service. Clients can prepend additional information indicating the name and version of the client application."
  },
  {
    "id": "python-http-telemetry-useragent",
    "category": "Telemetry",
    "text": "DO send telemetry information in the [User-Agent header] using the following format: <code>[&lt;application_id&gt; ]azsdk-python-&lt;package_name&gt;/&lt;package_version&gt; &lt;platform_info&gt; </code> <application_id>: optional application-specific string. May contain a slash, but must not contain a space. The string is supplied by the user of the client library, e.g. \"AzCopy/10.0.4-Preview\" <package_name>: client library (distribution) package name as it appears to the developer, replacing slashes with dashes and removing the Azure indicator. For example, \"azure-keyvault-secrets\" would specify \"azsdk-python-keyvault-secrets\". <package_version>: the version of the package. Note: this is not the version of the service <platform_info>: information about the currently executing language runtime and OS, e.g. \"Python/3.8.4 (Windows-10-10.0.19041-SP0)\" For example, if we re-wrote AzCopy in Python using the Azure Blob Storage client library, we may end up with the following user-agent strings: (Python) AzCopy/10.0.4-Preview azsdk-python-storage/4.0.0 Python/3.7.3 (Ubuntu; Linux x86_64; rv:34.0) The azure.core.pipeline.policies.UserAgentPolicy will provide this functionality if added to the HttpPipeline."
  },
  {
    "id": "python-azurecore-http-telemetry-dynamic",
    "category": "Telemetry",
    "text": "YOU SHOULD send additional (dynamic) telemetry information as a semi-colon separated set of key-value types in the X-MS-AZSDK-Telemetry header. For example: ```http X-MS-AZSDK-Telemetry: class=BlobClient;method=DownloadFile;blobType=Block ``` The content of the header is a semi-colon key=value list. The following keys have specific meaning: class is the name of the type within the client library that the consumer called to trigger the network operation. method is the name of the method within the client library type that the consumer called to trigger the network operation. Any other keys that are used should be common across all client libraries for a specific service. DO NOT include personally identifiable information (even encoded) in this header. Services need to configure log gathering to capture the X-MS-SDK-Telemetry header in such a way that it can be queried through normal analytics systems."
  },
  {
    "id": "python-azurecore-http-telemetry-appid",
    "category": "Considerations for clients not using the UserAgentPolicy from azure-core",
    "text": "DO allow the consumer of the library to set the application ID by passing in an application_id parameter to the service client constructor. This allows the consumer to obtain cross-service telemetry for their app."
  },
  {
    "id": "python-azurecore-http-telemetry-appid-length",
    "category": "Considerations for clients not using the UserAgentPolicy from azure-core",
    "text": "DO enforce that the application ID is no more than 24 characters in length. Shorter application IDs allows service teams to include diagnostic information in the \"platform information\" section of the user agent, while still allowing the consumer to obtain telemetry information for their own application."
  },
  {
    "id": "python-testing-pytest",
    "category": "Testing",
    "text": "DO use pytest (https://docs.pytest.org/en/latest/) as the test framework."
  },
  {
    "id": "python-testing-async",
    "category": "Testing",
    "text": "YOU SHOULD use pytest-asyncio (https://github.com/pytest-dev/pytest-asyncio) for testing of async code."
  },
  {
    "id": "python-testing-live",
    "category": "Testing",
    "text": "DO make your scenario tests runnable against live services. Strongly consider using the Python Azure-DevTools (https://github.com/Azure/azure-sdk-for-python/tree/main/tools/azure-devtools) package for scenario tests."
  },
  {
    "id": "python-testing-record",
    "category": "Testing",
    "text": "DO provide recordings to allow running tests offline/without an Azure subscription"
  },
  {
    "id": "python-testing-parallel",
    "category": "Testing",
    "text": "DO support simultaneous test runs in the same subscription."
  },
  {
    "id": "python-testing-independent",
    "category": "Testing",
    "text": "DO make each test case independent of other tests."
  },
  {
    "id": "python-tooling-pylint",
    "category": "Code Analysis and Style Tools",
    "text": "DO use pylint (https://www.pylint.org/) for your code. Use the pylintrc file in the root of the repository (https://github.com/Azure/azure-sdk-for-python/blob/main/pylintrc) "
  },
  {
    "id": "python-tooling-flake8",
    "category": "Code Analysis and Style Tools",
    "text": "DO use flake8-docstrings (https://gitlab.com/pycqa/flake8-docstrings) to verify doc comments."
  },
  {
    "id": "python-tooling-black",
    "category": "Code Analysis and Style Tools",
    "text": "DO use Black (https://black.readthedocs.io/en/stable/) for formatting your code."
  },
  {
    "id": "python-tooling-mypy",
    "category": "Code Analysis and Style Tools",
    "text": "YOU SHOULD use MyPy (https://mypy.readthedocs.io/en/latest/) to statically check the public surface area of your library. You don't need to check non-shipping code such as tests. The azure-core package provides common functionality for client libraries. Documentation and usage examples can be found in the [azure/azure-sdk-for-python] repository. The HTTP pipeline is an HTTP transport that is wrapped by multiple policies. Each policy is a control point that can modify either the request or response. A default set of policies is provided to standardize how client libraries interact with Azure services. For more information on the Python implementation of the pipeline, see the documentation (https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/core/azure-core)  Many of the protocols mandated by the design guidelines have default implementations in azure-core. ```python T = TypeVar(\"T\") class LROPoller(Protocol):   def result(self, timeout=None) -&gt; T:     \"\"\" Retrieve the final result of the long running operation.     :param timeout: How long to wait for operation to complete (in seconds). If not specified, there is no timeout.     :raises TimeoutException: If the operation has not completed before it timed out.     \"\"\"     ...   def wait(self, timeout=None) -&gt; None:     \"\"\" Wait for the operation to complete.     :param timeout: How long to wait for operation to complete (in seconds). If not specified, there is no timeout.     \"\"\"   def done(self) -&gt; boolean:     \"\"\" Check if long running operation has completed.     \"\"\"   def add_done_callback(self, func) -&gt; None:     \"\"\" Register callback to be invoked when operation completes.     :param func: Callable that will be called with the eventual result ('T') of the operation.     \"\"\"     ... ``` azure.core.polling.LROPoller implements the LROPoller protocol. ```python T = TypeVar(\"T\") class ByPagePaged(Protocol, Iterable[Iterable[T]]):   continuation_token: \"str\" class ItemPaged(Protocol, Iterable[T]):   continuation_token: \"str\"   def by_page(self) -&gt; ByPagePaged[T] ... ``` azure.core.ItemPaged implements the ItemPaged protocol. See the ItemPaged protocol for additional information. ```python class ResponseHook(Protocol):   __call__(self, headers, deserialized_response): -&gt; None ...  ```"
  },
  {
    "id": "python-codestyle-pep8",
    "category": "Python language and code style",
    "text": "DO follow the general guidelines in PEP8 (https://www.python.org/dev/peps/pep-0008/) unless explicitly overridden in this document."
  },
  {
    "id": "python-codestyle-idiomatic",
    "category": "Python language and code style",
    "text": "DO NOT \"borrow\" coding paradigms from other languages. For example, no matter how common Reactive programming is in the Java community, it's still unfamiliar for most Python developers."
  },
  {
    "id": "python-codestyle-consistency",
    "category": "Python language and code style",
    "text": "DO favor consistency with other Python components over other libraries for the same service. It's more likely that a developer will use many different libraries using the same language than a developer will use the same service from many different languages."
  },
  {
    "id": "python-errors-use-chaining",
    "category": "Error handling",
    "text": "DO use exception chaining to include the original source of the error when catching and raising new exceptions. ```python # Yes: try:   # do something   something() except:   # __context__ will be set correctly   raise MyOwnErrorWithNoContext() # No: success = True try:   # do something   something() except:   success = False if not success:   # __context__ is lost...   raise MyOwnErrorWithNoContext() ```"
  },
  {
    "id": "python-codestyle-vars-naming",
    "category": "Naming conventions",
    "text": "DO use snake_case for variable, function, and method names: ```python # Yes: service_client = ServiceClient() service_client.list_things() def do_something():   ... # No: serviceClient = ServiceClient() service_client.listThings() def DoSomething():   ... ```"
  },
  {
    "id": "python-codestyle-type-naming",
    "category": "Naming conventions",
    "text": "DO use Pascal case for types: ```python # Yes: class ThisIsCorrect(object):   pass # No: class this_is_not_correct(object):   pass # No: class camelCasedTypeName(object):   pass ```"
  },
  {
    "id": "python-codestyle-const-naming",
    "category": "Naming conventions",
    "text": "DO use ALL CAPS for constants: ```python # Yes: MAX_SIZE = 4711 # No: max_size = 4711 # No: MaxSize = 4711 ```"
  },
  {
    "id": "python-codestyle-module-naming",
    "category": "Naming conventions",
    "text": "DO use snake_case for module names."
  },
  {
    "id": "python-codestyle-static-methods",
    "category": "Method signatures",
    "text": "DO NOT use static methods (staticmethod (https://docs.python.org/3/library/functions.html#staticmethod) . Prefer module level functions instead. Static methods are rare and usually forced by other libraries."
  },
  {
    "id": "python-codestyle-properties",
    "category": "Method signatures",
    "text": "DO NOT use simple getter and setter functions. Use properties instead. ```python # Yes class GoodThing(object):   @property   def something(self):     \"\"\" Example of a good read-only property.\"\"\"     return self._something # No class BadThing(object):   def get_something(self):     \"\"\" Example of a bad 'getter' style method.\"\"\"     return self._something ```"
  },
  {
    "id": "python-codestyle-long-args",
    "category": "Method signatures",
    "text": "YOU SHOULD NOT have methods that require more than five positional parameters. Optional/flag parameters can be accepted using keyword-only arguments, or **kwargs. See : insert link for general guidance on positional vs. optional parameters here."
  },
  {
    "id": "python-codestyle-optional-args",
    "category": "Method signatures",
    "text": "DO use keyword-only arguments for optional or less-often-used arguments for modules that only need to support Python 3. ```python # Yes def foo(a, b, *, c, d=None):   # Note that I can even have required keyword-only arguments...   ... ```"
  },
  {
    "id": "python-codestyle-kwargs",
    "category": "Method signatures",
    "text": "DO use keyword-only arguments for arguments that have no obvious ordering. ```python # Yes - `source` and `dest` have logical order, `recurse` and `overwrite` do not. def copy(source, dest, *, recurse=False, overwrite=False) ...  # No def copy(source, dest, recurse=False, overwrite=False) ... ```"
  },
  {
    "id": "python-codestyle-positional-params",
    "category": "Method signatures",
    "text": "DO specify the parameter name when calling methods with more than two required positional parameters. ```python def foo(a, b, c):   pass  def bar(d, e):   pass  # Yes: foo(a=1, b=2, c=3) bar(1, 2) bar(e=3, d=4) # No: foo(1, 2, 3) ```"
  },
  {
    "id": "python-codestyle-optional-param-calling",
    "category": "Method signatures",
    "text": "DO specify the parameter name for optional parameters when calling functions. ```python def foo(a, b=1, c=None):   pass  # Yes: foo(1, b=2, c=3) # No: foo(1, 2, 3) ```"
  },
  {
    "id": "python-codestyle-private-api",
    "category": "Public vs \"private\"",
    "text": "DO use a single leading underscore to indicate that a name isn't part of the public API. Non-public APIs aren't guaranteed to be stable."
  },
  {
    "id": "python-codestyle-double-underscore",
    "category": "Public vs \"private\"",
    "text": "DO NOT use leading double underscore prefixed method names unless name clashes in the inheritance hierarchy are likely. Name clashes are rare."
  },
  {
    "id": "python-codestyle-public-api",
    "category": "Public vs \"private\"",
    "text": "DO add public methods and types to the module's __all__ attribute."
  },
  {
    "id": "python-codestyle-interal-module",
    "category": "Public vs \"private\"",
    "text": "DO use a leading underscore for internal modules. You may omit a leading underscore if the module is a submodule of an internal module. ```python # Yes: azure.exampleservice._some_internal_module # Yes - some_internal_module is still considered internal since it is a submodule of an internal module: azure.exampleservice._internal.some_internal_module # No - some_internal_module is considered public: azure.exampleservice.some_internal_module ```"
  },
  {
    "id": "python-codestyle-structural-subtyping",
    "category": "Types (or not)",
    "text": "DO prefer structural subtyping and protocols over explicit type checks."
  },
  {
    "id": "python-codestyle-abstract-collections",
    "category": "Types (or not)",
    "text": "DO derive from the abstract collections base classes collections.abc (or collections for Python 2.7) to provide custom mapping types."
  },
  {
    "id": "python-codestyle-pep484",
    "category": "Types (or not)",
    "text": "DO provide type hints PEP484 (https://www.python.org/dev/peps/pep-0484/) for publicly documented classes and functions. See the suggested syntax for Python 2.7 and 2.7-3.x straddling code (https://www.python.org/dev/peps/pep-0484/#suggested-syntax-for-python-2-7-and-straddling-code) for guidance for Python 2.7 compatible code. Do not do this for code that is Python 3 specific (e.g. async clients.)"
  },
  {
    "id": "python-codestyle-thread-affinity",
    "category": "Threading",
    "text": "DO maintain thread affinity for user-provided callbacks unless explicitly documented to not do so."
  },
  {
    "id": "python-codestyle-document-thread-safety",
    "category": "Threading",
    "text": "DO explicitly include the fact that a method (function/class) is thread safe in its documentation. Examples: asyncio.loop.call_soon_threadsafe (https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.call_soon_threadsafe) queue (https://docs.python.org/3/library/queue.html) "
  },
  {
    "id": "python-codestyle-use-executor",
    "category": "Threading",
    "text": "YOU SHOULD allow callers to pass in an Executor (https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor) instance rather than defining your own thread or process management for parallelism. You may do your own thread management if the thread isn't exposed to the caller in any way. For example, the LROPoller implementation uses a background poller thread. [Zen of Python]: https://www.python.org/dev/peps/pep-0020/ [universal package]: https://packaging.python.org/guides/distributing-packages-using-setuptools/#id75 [Architecture board]: https://azure.github.io/azure-sdk/policies_reviewprocess.html [issue]: https://github.com/azure/azure-sdk/issues <!-- Intra-document links --> [Packaging]: python_implementation.html#packaging [HTTP pipeline]: python_implementation.html#azure-core [PagingDesign]: python_design.html#methods-returning-collections-paging [azure/azure-sdk-for-python]: https://github.com/azure/azure-sdk-for-python [positional and keyword-only arguments]: python_implementation.html#python-codestyle-long-args [structural type checking]: python_implementation.html#types-or-not"
  }
]